## 10.1 Android的消息机制概述

1. 耗时操作不要在UI线程中使用
2. Android操作UI只能在主线程(UI线程)中操作
    - UI操作不使用多线程加锁方式的原因有二:
        - 首先加上锁机制会让UI访问的逻辑变得复杂；
        - 其次锁机制会降低UI访问的效率，因为锁机制会阻塞某些线程的执行

根据1、2两点，则在进行完耗时操作之后需要把一个任务切换到UI线程中，这时就需要Handler来切换
```java
Android会判断UI操作是不是在UI线程中进行，不是会抛出异常

void checkThread() {
    if (mThread != Thread.currentThread()) {
        throw new CalledFromWrongThreadException("Only the original thread that created a view hierarchy can touch its views.");
    }
}
```

### Handler的post和send
- Handler的post方法将一个Runnable投递到Handler内部的Looper中去处理
- 也可以通过Handler的send方法发送一个消息，这个消息同样会在Looper中去处理

#### 调用逻辑
1. 当Handler的send方法被调用时，它会调用MessageQueue的enqueueMessage方法将这个消息放入消息队列中
2. 然后Looper发现有新消息到来时，就会处理这个消息
3. 最终消息中的Runnable或者Handler的handleMessage方法就会被调用
**注意Looper是运行在创建Handler所在的线程中的，这样一来Handler中的业务逻辑就被切换到创建Handler所在的线程中去执行了**
[![jg9diQ.png](https://s1.ax1x.com/2022/07/12/jg9diQ.png)](https://imgtu.com/i/jg9diQ)